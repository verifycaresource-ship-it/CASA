{% extends "dashboard/base.html" %}
{% load static %}
{% block title %}Assignment Details | HealthInsure{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto bg-white dark:bg-gray-800 p-6 rounded-xl shadow mt-8 space-y-6">
  <h2 class="text-2xl font-semibold mb-4">ğŸ¥ Assignment Details</h2>

  <!-- Header -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Client Info -->
    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
      <h3 class="text-lg font-semibold mb-2">ğŸ‘¤ Client Information</h3>
      <p><strong>Name:</strong> {{ assignment.client.full_name }}</p>
      <p><strong>Email:</strong> {{ assignment.client.email|default:"â€”" }}</p>
      <p><strong>Phone:</strong> {{ assignment.client.phone|default:"â€”" }}</p>
      <p><strong>Gender:</strong> {{ assignment.client.gender|capfirst }}</p>
      <p><strong>Age:</strong> {{ assignment.client.age|default:"â€”" }}</p>
      <p><strong>Address:</strong> {{ assignment.client.address|default:"â€”" }}</p>
    </div>

    <!-- Policy Info -->
    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
      <h3 class="text-lg font-semibold mb-2">ğŸ“„ Policy Information</h3>
      <p><strong>Policy Number:</strong> {{ assignment.policy.policy_number }}</p>
      <p><strong>Policy Type:</strong> {{ assignment.policy.policy_type }}</p>
      <p><strong>Premium:</strong> {{ assignment.policy.premium }}</p>
      <p><strong>Start Date:</strong> {{ assignment.policy.start_date|date:"M d, Y" }}</p>
      <p><strong>Expiry Date:</strong> {{ assignment.policy.expiry_date|date:"M d, Y" }}</p>
      <p><strong>Status:</strong> 
        {% if assignment.policy.is_active %}
          <span class="text-green-600 font-semibold">Active</span>
        {% else %}
          <span class="text-red-600 font-semibold">Inactive</span>
        {% endif %}
      </p>
    </div>
  </div>

  <!-- Hospital & Assignment Info -->
  <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
    <h3 class="text-lg font-semibold mb-2">ğŸ¥ Hospital Assignment</h3>
    <p><strong>Hospital:</strong> {{ assignment.hospital.name }}</p>
    <p><strong>Assigned By:</strong> {% if assignment.assigned_by %}{{ assignment.assigned_by.username }}{% else %}System{% endif %}</p>
    <p><strong>Assigned At:</strong> {{ assignment.assigned_at|date:"M d, Y H:i" }}</p>
    <p><strong>Status:</strong> 
      {% if assignment.status == "pending" %}
        <span class="px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs font-semibold">Pending</span>
      {% elif assignment.status == "accepted" %}
        <span class="px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold">Accepted</span>
      {% elif assignment.status == "claimed" %}
        <span class="px-2 py-1 rounded-full bg-purple-100 text-purple-800 text-xs font-semibold">Claimed</span>
      {% elif assignment.status == "completed" %}
        <span class="px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-semibold">Completed</span>
      {% elif assignment.status == "rejected" %}
        <span class="px-2 py-1 rounded-full bg-red-100 text-red-800 text-xs font-semibold">Rejected</span>
      {% else %}
        <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-800 text-xs font-semibold">{{ assignment.status|capfirst }}</span>
      {% endif %}
    </p>
    {% if assignment.notes %}
      <p><strong>Notes:</strong> {{ assignment.notes }}</p>
    {% endif %}
  </div>

  <!-- Claim Info (if exists) -->
  {% if assignment.claim %}
  <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
    <h3 class="text-lg font-semibold mb-2">ğŸ’° Claim Details</h3>
    <p><strong>Claim Number:</strong> {{ assignment.claim.claim_number }}</p>
    <p><strong>Amount:</strong> {{ assignment.claim.amount }}</p>
    <p><strong>Status:</strong> 
      {% if assignment.claim.status == "pending" %}
        <span class="px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs font-semibold">Pending</span>
      {% elif assignment.claim.status == "approved" %}
        <span class="px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-semibold">Approved</span>
      {% elif assignment.claim.status == "rejected" %}
        <span class="px-2 py-1 rounded-full bg-red-100 text-red-800 text-xs font-semibold">Rejected</span>
      {% elif assignment.claim.status == "reimbursed" %}
        <span class="px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold">Reimbursed</span>
      {% endif %}
    </p>
    {% if assignment.claim.notes %}
      <p><strong>Notes:</strong> {{ assignment.claim.notes }}</p>
    {% endif %}
    {% if assignment.claim.document %}
      <p><strong>Document:</strong> 
        <a href="{{ assignment.claim.document.url }}" class="text-blue-600 hover:underline" target="_blank">View Attachment</a>
      </p>
    {% endif %}
    <p><strong>Created By:</strong> {% if assignment.claim.created_by %}{{ assignment.claim.created_by.username }}{% else %}System{% endif %}</p>
    <p><strong>Created At:</strong> {{ assignment.claim.created_at|date:"M d, Y H:i" }}</p>

    <div class="mt-3">
      <a href="{% url 'claims:claim_detail' assignment.claim.id %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">View Full Claim</a>
    </div>
  </div>
  {% else %}
  <!-- If no claim yet -->
  <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center">
    <p class="text-gray-500 text-sm italic mb-2">No claim has been submitted for this assignment yet.</p>
    {% if assignment.status == "accepted" %}
      <a href="{% url 'hospitals:submit_claim_for_assignment' assignment.id %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">Submit Claim</a>
    {% endif %}
  </div>
  {% endif %}

  <!-- Back button -->
  <div class="text-right">
    <a href="{% url 'hospitals:assigned_clients' %}" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded text-sm">â† Back to List</a>
  </div>
</div>
{% endblock %}
